version: '3.8'

services:
  deepseek:
    # 镜像名称：Docker Hub 用户名/仓库名:版本
    image: orzg/learnsite-deepseek:latest
    # 容器名称，方便管理
    container_name: learnsite-deepseek
    network_mode: bridge
    ports:
      # 左边是宿主机端口，右边是容器端口
      # 格式：宿主机端口:容器端口
      # 如果宿主机2000端口被占用，可以改成其他端口如 "8080:2000"
      - "2000:2000"
    environment:
      # ====== API 密钥配置 ======
      
      # 【必填】DeepSeek API Key
      # 申请地址：https://platform.deepseek.com
      # 示例：sk-xxxxxxxxxxxxxxxxxxxxxxxx
      - DEEPSEEK_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxx
      
      # 【可选】Qwen API Key（阿里云 DashScope）
      # 申请地址：https://dashscope.console.aliyun.com
      # 如不填写则使用默认测试 Key（可能有限额）
      - QWEN_API_KEY=
      
      # 【可选】智谱 AI API Key（用于 /photos 图片生成）
      # 申请地址：https://open.bigmodel.cn
      # 如不填写则使用默认测试 Key（可能有限额）
      - PHOTO_API_KEY=
      
      # ====== 服务配置 ======
      # 监听地址，0.0.0.0 表示监听所有网卡
      - HOST_IP=0.0.0.0
    volumes:
      # 映射宿主机源码目录（用于开发调试）
      # 群晖示例：/volume1/docker/learnsite/app/deepseek:/app
      - /volume1/docker/learnsite/app/deepseek:/app
    # 自动重启
    restart: unless-stopped
    # 健康检查配置（首次启动建议注释掉，便于排查问题）
    # healthcheck:
    #   test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:2000/health')"]
    #   interval: 30s
    #   timeout: 10s
    #   retries: 3
    #   start_period: 60s
